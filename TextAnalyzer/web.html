<!DOCTYPE html>
<html>
  <head>
    <title>Advanced Text Analyzer</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 40px;
        background: #f5f5f5;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
      }
      .feature-list {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      textarea {
        width: 100%;
        height: 200px;
        margin: 10px 0;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      button {
        padding: 12px 25px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      .result {
        margin-top: 20px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 5px;
        display: none;
      }
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .stat-card {
        background: white;
        padding: 15px;
        border-radius: 5px;
        border-left: 4px solid #007bff;
      }
      .file-info {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 5px;
        margin: 15px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üìä Advanced Text Analyzer</h1>

      <div class="feature-list">
        <h3>‚ú® Supported Features:</h3>
        <p><strong>Document Types:</strong> PDF, DOCX, TXT</p>
        <p>
          <strong>Analysis:</strong> Word count, character stats, sentence
          analysis, common words, readability scores, and more!
        </p>
      </div>

      <h3>üìù Analyze Direct Text:</h3>
      <textarea id="textInput" placeholder="Paste your text here...">
Artificial intelligence is transforming various industries. Machine learning algorithms analyze vast amounts of data to identify patterns and make predictions. This technology enables computers to perform tasks that typically require human intelligence.</textarea
      >
      <button onclick="analyzeText()">Analyze Text</button>

      <h3>üìÑ Or Upload Document:</h3>
      <input type="file" id="fileInput" accept=".pdf,.docx,.txt,.doc" />
      <button onclick="analyzeFile()">Analyze Document</button>
      <small>Supported: PDF, DOCX, TXT files (Max 10MB)</small>

      <div id="result" class="result"></div>
    </div>

    <script>
      async function analyzeText() {
        const text = document.getElementById("textInput").value;
        if (!text.trim()) {
          alert("Please enter some text");
          return;
        }

        showLoading();
        try {
          const response = await fetch("/analyze/text", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ text: text }),
          });

          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.detail || "Analysis failed");
          }

          const result = await response.json();
          displayResult(result);
        } catch (error) {
          showError(error.message);
        }
      }

      async function analyzeFile() {
        const fileInput = document.getElementById("fileInput");
        const file = fileInput.files[0];

        if (!file) {
          alert("Please select a file");
          return;
        }

        // Validate file type
        const fileName = file.name.toLowerCase();
        if (
          !fileName.endsWith(".pdf") &&
          !fileName.endsWith(".docx") &&
          !fileName.endsWith(".txt") &&
          !fileName.endsWith(".doc")
        ) {
          alert("Please select a PDF, DOCX, or TXT file");
          return;
        }

        showLoading();
        try {
          const formData = new FormData();
          formData.append("file", file);

          const response = await fetch("/analyze/file", {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.detail || "File analysis failed");
          }

          const result = await response.json();
          displayResult(result, true);
        } catch (error) {
          showError(error.message);
        }
      }

      function showLoading() {
        const resultDiv = document.getElementById("result");
        resultDiv.style.display = "block";
        resultDiv.innerHTML = "<p>‚è≥ Analyzing... Please wait.</p>";
      }

      function showError(message) {
        const resultDiv = document.getElementById("result");
        resultDiv.style.display = "block";
        resultDiv.innerHTML = `<div style="color: red; background: #ffe6e6; padding: 15px; border-radius: 5px;">
                    <strong>Error:</strong> ${message}
                </div>`;
      }

      function displayResult(data, isFile = false) {
        const resultDiv = document.getElementById("result");
        resultDiv.style.display = "block";

        let fileInfoHtml = "";
        if (isFile && data.file_info) {
          fileInfoHtml = `
                        <div class="file-info">
                            <h4>üìã Document Information</h4>
                            <p><strong>File:</strong> ${
                              data.file_info.filename
                            }</p>
                            <p><strong>Size:</strong> ${(
                              data.file_info.file_size / 1024
                            ).toFixed(2)} KB</p>
                            ${
                              data.document_info
                                ? `<p><strong>Type:</strong> ${data.document_info.file_type.toUpperCase()}</p>`
                                : ""
                            }
                            ${
                              data.document_info
                                ? `<p><strong>Pages:</strong> ${data.document_info.page_count}</p>`
                                : ""
                            }
                        </div>
                    `;
        }

        resultDiv.innerHTML = `
                    <h3>üìä Analysis Results</h3>
                    ${fileInfoHtml}
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <strong>üìù Words</strong><br>
                            ${data.word_count}
                        </div>
                        <div class="stat-card">
                            <strong>üî§ Sentences</strong><br>
                            ${data.sentence_count}
                        </div>
                        <div class="stat-card">
                            <strong>üìñ Paragraphs</strong><br>
                            ${data.paragraph_count}
                        </div>
                        <div class="stat-card">
                            <strong>‚ú® Unique Words</strong><br>
                            ${data.unique_words}
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <strong>üî¢ Characters (with spaces)</strong><br>
                            ${data.character_counts.with_spaces}
                        </div>
                        <div class="stat-card">
                            <strong>üî° Characters (no spaces)</strong><br>
                            ${data.character_counts.without_spaces}
                        </div>
                        <div class="stat-card">
                            <strong>‚è±Ô∏è Reading Time</strong><br>
                            ${data.readability.reading_time_minutes} min
                        </div>
                        <div class="stat-card">
                            <strong>üìê Avg. Sentence Length</strong><br>
                            ${data.readability.average_sentence_length} words
                        </div>
                    </div>

                    <div style="margin: 20px 0;">
                        <h4>üìà Most Common Words</h4>
                        <ul>
                            ${data.common_words
                              .map(
                                (word) =>
                                  `<li>"<strong>${word.word}</strong>" - ${word.count} times (${word.percentage}%)</li>`
                              )
                              .join("")}
                        </ul>
                    </div>

                    <div style="margin: 20px 0;">
                        <h4>üìè Longest Words</h4>
                        <ul>
                            ${data.longest_words
                              .map(
                                (word) =>
                                  `<li>"<strong>${word.word}</strong>" - ${word.length} characters</li>`
                              )
                              .join("")}
                        </ul>
                    </div>
                `;
      }

      // Auto-analyze sample text on page load
      window.onload = function () {
        setTimeout(() => {
          analyzeText();
        }, 1000);
      };
    </script>
  </body>
</html>
