# infra/Dockerfile.backend
FROM node:18-alpine AS builder
WORKDIR /app

# install deps (only prod)
COPY backend/package*.json ./
RUN npm ci --production

# copy app source
COPY backend/src ./src
COPY backend/.env ./

# create a non-root user
RUN addgroup -S appgroup && adduser -S appuser -G appgroup
RUN chown -R appuser:appgroup /app
USER appuser

ENV NODE_ENV=production
ENV PORT=5000

EXPOSE 5000
CMD ["node", "src/server.js"]
